2.1
CREATE INDEX idx_account_db_id ON arena_members (account_db_id);

WITH limits AS (
  SELECT ROUND(COUNT(DISTINCT account_db_id) * 0.05) AS limit_value
  FROM arena_members
)
SELECT account_db_id, SUM(damage) AS total_damage
FROM arena_members
GROUP BY account_db_id
ORDER BY total_damage DESC
LIMIT (SELECT limit_value FROM limits);


2.2
CREATE INDEX idx_account_db_id ON arena_members (account_db_id);
CREATE INDEX idx_vehicle_type_id ON arena_members (vehicle_type_id);

WITH limits AS (
  SELECT ROUND(COUNT(DISTINCT account_db_id) * 0.05) AS limit_value
  FROM arena_members
)
SELECT am.account_db_id, gs.item_name as ship_name, MAX(am.damage) AS dealt_damage
FROM arena_members am
JOIN glossary_ships gs ON am.vehicle_type_id = gs.item_cd
WHERE am.account_db_id IN 
(
SELECT account_db_id
 From 
    (
      SELECT account_db_id, SUM(damage) AS total_damage
      FROM arena_members
      GROUP BY account_db_id
      ORDER BY total_damage DESC
      LIMIT (SELECT limit_value FROM limits)
    )
)
GROUP BY am.account_db_id
ORDER BY dealt_damage DESC
LIMIT 10;
